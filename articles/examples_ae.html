<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="eider">
<title>Examples: A&amp;E data • eider</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Fira_Sans-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Fira_Mono-0.4.9/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Examples: A&amp;E data">
<meta property="og:description" content="eider">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">eider</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/eider.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Features as JSON</h6>
    <a class="dropdown-item" href="../articles/features.html">An overview of features</a>
    <a class="dropdown-item" href="../articles/filtering.html">Filtering</a>
    <a class="dropdown-item" href="../articles/preprocessing.html">Preprocessing</a>
    <a class="dropdown-item" href="../articles/combination.html">Combination features</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Logging</h6>
    <a class="dropdown-item" href="../articles/logging.html">Logging and errors</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Gallery</h6>
    <a class="dropdown-item" href="../articles/examples_ae.html">Examples: A&amp;E data</a>
    <a class="dropdown-item" href="../articles/examples_ltc.html">Examples: LTC data</a>
    <a class="dropdown-item" href="../articles/examples_pis.html">Examples: PIS data</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="examples_ae_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Examples: A&amp;E data</h1>
            
      
      
      <div class="d-none name"><code>examples_ae.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">eider</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></code></pre></div>
<p>This series of vignettes in the <em>Gallery</em> section aim to demonstrate the functionality of <code>eider</code> through examples that are similar to real-life usage. To do this, we have created a series of randomly generated datasets that are stored with the package. You can access these datasets using the <code><a href="../reference/eider_example.html">eider_example()</a></code> function, which will return the path to where the dataset is stored in your installation of R.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ae_data_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eider_example.html">eider_example</a></span><span class="op">(</span><span class="st">"random_ae_data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ae_data_filepath</span></span>
<span><span class="co">#&gt; [1] "/tmp/RtmpiXasWE/temp_libpath1726322f63c1/eider/extdata/random_ae_data.csv"</span></span></code></pre></div>
<div class="section level2">
<h2 id="the-data">The data<a class="anchor" aria-label="anchor" href="#the-data"></a>
</h2>
<p>In this specific vignette, we are using simulated <a href="https://publichealthscotland.scot/publications/ae-data-mart-user-guide/" class="external-link">accident and emergency (A&amp;E) data</a>. Our dataset does not contain every column specified in here, but serves as a useful example of how real-life data may be treated using <code>eider</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ae_data</span> <span class="op">&lt;-</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">ae_data_filepath</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">ae_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 100</span></span>
<span><span class="co">#&gt; Columns: 6</span></span>
<span><span class="co">#&gt; $ id                  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 15, 0, 3, 7, 18, 15, 6, 2, 14, 8, 0, 13, 6, 2, 13,…</span></span>
<span><span class="co">#&gt; $ date                <span style="color: #949494; font-style: italic;">&lt;date&gt;</span> 2017-06-12, 2017-12-22, 2016-10-28, 2016-09-06, 2…</span></span>
<span><span class="co">#&gt; $ attendance_category <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 5, 1, 3, 3, 2, 4, 4, 4, 4, 1, 4, 5, 3, 1, 3, 3, 2,…</span></span>
<span><span class="co">#&gt; $ diagnosis_1         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 15, 16, 1, 12, 2, 18, 17, 18, 10, 11, 12, 10, 8…</span></span>
<span><span class="co">#&gt; $ diagnosis_2         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 18, 8, 7, NA, 3, 17, 8, NA, 9, 2, 12, NA, 99, 19, …</span></span>
<span><span class="co">#&gt; $ diagnosis_3         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 7, NA, NA, NA, NA, 3, NA, NA, 8, 7, 7, NA, NA, NA,…</span></span></code></pre></div>
<p>(Note that when the data is loaded by <code>eider</code>, the date columns are automatically converted to the date type for you: you do not need to do the manual processing above.)</p>
<p>This simplified table has 6 columns:</p>
<ul>
<li>
<code>id</code>, which is a numeric patient ID;</li>
<li>
<code>date</code>, when the admission occurred;</li>
<li>
<code>attendance_category</code>, a numeric value indicating <a href="https://publichealthscotland.scot/services/national-data-catalogue/data-dictionary/a-to-z-of-data-dictionary-terms/attendance-category-ae/" class="external-link">the context for the patient’s admission</a>;</li>
<li>
<code>diagnosis_1</code>, <code>diagnosis_2</code>, and <code>diagnosis_3</code>, which are numeric values indicating <a href="https://publichealthscotland.scot/services/national-data-catalogue/data-dictionary/a-to-z-of-data-dictionary-terms/diagnosis-ae/" class="external-link">the patient’s diagnoses</a>. Note that <code>diagnosis_2</code> and <code>diagnosis_3</code> may not necessarily exist for every entry.</li>
</ul>
<p>From the first row in this example, we can see that patient 15 was admitted on 12 June 2017. They had 3 unique diagnosis codes: 1, 18, and 7.</p>
</div>
<div class="section level2">
<h2 id="feature-1-total-number-of-attendances">Feature 1: Total number of attendances<a class="anchor" aria-label="anchor" href="#feature-1-total-number-of-attendances"></a>
</h2>
<p>As a first example, we will calculate the total number of attendances for each patient. This feature may be specified in JSON as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ae_count_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eider_example.html">eider_example</a></span><span class="op">(</span><span class="st">"ae_total_attendances.json"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">ae_count_filepath</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "source_file": "ae",</span></span>
<span><span class="co">#&gt;   "transformation_type": "COUNT",</span></span>
<span><span class="co">#&gt;   "grouping_column": "id",</span></span>
<span><span class="co">#&gt;   "absent_default_value": 0,</span></span>
<span><span class="co">#&gt;   "output_feature_name": "total_ae_attendances"</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>This JSON file is also provided as part of the package, and as with the data, can be accessed using the <code><a href="../reference/eider_example.html">eider_example()</a></code> function. It contains the following information:</p>
<ul>
<li>
<code>source_file</code> specifies the identifier by which the input table is provided to <code>eider</code>;</li>
<li>
<code>output_feature_name</code> specifies the name of the column that will be created in the output table;</li>
<li>
<code>absent_default_value</code> specifies the value that will be used when a patient does not appear in the table. In this case, the logical value to use is 0: if a patient does not appear in the A&amp;E table, it means they have 0 attendances.</li>
<li>
<code>grouping_column</code> specifies the column by which the table will be grouped. In this case, it is the <code>id</code> column.</li>
<li>
<code>transformation_type</code> specifies the way in which the feature is calculated. Here, a value of <code>"count"</code> means that the number of rows for each <code>id</code> will simply be counted.</li>
</ul>
<p>This is one of the simplest possible features that can be calculated using <code>eider</code>. It can be run using the <code><a href="../reference/run_pipeline.html">run_pipeline()</a></code> function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_pipeline.html">run_pipeline</a></span><span class="op">(</span></span>
<span>  data_sources <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ae <span class="op">=</span> <span class="va">ae_data_filepath</span><span class="op">)</span>,</span>
<span>  feature_filenames <span class="op">=</span> <span class="va">ae_count_filepath</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">features</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 20</span></span>
<span><span class="co">#&gt; Columns: 2</span></span>
<span><span class="co">#&gt; $ id                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,…</span></span>
<span><span class="co">#&gt; $ total_ae_attendances <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 9, 3, 3, 4, 2, 5, 6, 8, 7, 2, 5, 4, 6, 8, 3, 5, 1…</span></span></code></pre></div>
<p>As described in the <a href="eider.html">introductory vignette</a>, the <code><a href="../reference/run_pipeline.html">run_pipeline()</a></code> function returns both <em>features</em> and <em>responses</em>. In this case, because we provided <code>ae_count_filepath</code> as one of the <code>feature_filenames</code>, the data we are interested in is returned as part of <code>res$features</code>.</p>
<p>Notice also how the <code>data_sources</code> argument takes a named list. The names of this list are used to match the <code>source_file</code> in the JSON file to the actual data. In this case, because the <code>source_file</code> is <code>"ae"</code>, we need to specify the data to be used as <code>ae = ae_data_filepath</code>.</p>
</div>
<div class="section level2">
<h2 id="feature-2-total-number-of-neurology-attendances-in-2017">Feature 2: Total number of neurology attendances in 2017<a class="anchor" aria-label="anchor" href="#feature-2-total-number-of-neurology-attendances-in-2017"></a>
</h2>
<p>As a second example, we will calculate the total number of attendances for each patient for which:</p>
<ul>
<li>the date is within 2017; and</li>
<li>they have a diagnosis pertaining to neurology (which corresponds to a diagnosis code of 13).</li>
</ul>
<p>As before, this feature is still a <code>"count"</code> transformation. However, we must additionally apply a filter to the the table before performing the count, to ensure that only the rows we are interested in are counted (see <a href="filtering.html">the filtering vignette</a> for more examples of this).</p>
<div class="section level3">
<h3 id="the-date">The date<a class="anchor" aria-label="anchor" href="#the-date"></a>
</h3>
<p>In this filter, we want to constrain the date to be between 1 January 2017 and 31 December 2017. There is no specific filter for a date range; however, we can construct this as the <a href="https://en.wikipedia.org/wiki/Logical_conjunction" class="external-link">conjunction</a> of two subfilters: one which restricts the date to be on or after 1 January 2017, and one which restricts it to be on or before 31 December 2017. Both of these filters must be simultaneously satisfied; thus, we need to use an <code>"and"</code> filter:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="fu">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>    <span class="er">...</span><span class="fu">,</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a>    <span class="dt">"filter"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"and"</span><span class="fu">,</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a>        <span class="dt">"subfilter"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>            <span class="dt">"date1"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>                <span class="dt">"column"</span><span class="fu">:</span> <span class="st">"date"</span><span class="fu">,</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a>                <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"date_gt_eq"</span><span class="fu">,</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>                <span class="dt">"value"</span><span class="fu">:</span> <span class="st">"2017-01-01"</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a>            <span class="fu">},</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a>            <span class="dt">"date2"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a>                <span class="dt">"column"</span><span class="fu">:</span> <span class="st">"date"</span><span class="fu">,</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a>                <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"date_lt_eq"</span><span class="fu">,</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a>                <span class="dt">"value"</span><span class="fu">:</span> <span class="st">"2017-12-31"</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a>            <span class="fu">}</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a>        <span class="fu">}</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a>    <span class="fu">}</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true"></a><span class="fu">}</span></span></code></pre></div>
<p>Note that the names for the subfilters—<code>"date1"</code> and <code>"date2"</code>—are arbitrary; they are just used to distinguish between the two subfilters. You can choose any names you consider useful.</p>
</div>
<div class="section level3">
<h3 id="the-diagnosis">The diagnosis<a class="anchor" aria-label="anchor" href="#the-diagnosis"></a>
</h3>
<p>Because the numeric diagnosis can occur in any of the three diagnosis columns, we need to check all three and retain any rows where any of the three diagnosis columns are equal to 13.</p>
<p>This is accomplished with an <code>"or"</code> filter:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true"></a><span class="fu">{</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true"></a>    <span class="er">...</span><span class="fu">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true"></a>    <span class="dt">"filter"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"or"</span><span class="fu">,</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true"></a>        <span class="dt">"subfilter"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true"></a>            <span class="dt">"diag1"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true"></a>                <span class="dt">"column"</span><span class="fu">:</span> <span class="st">"diagnosis_1"</span><span class="fu">,</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true"></a>                <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"in"</span><span class="fu">,</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true"></a>                <span class="dt">"value"</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">13</span><span class="ot">]</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true"></a>            <span class="fu">},</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true"></a>            <span class="dt">"diag2"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true"></a>                <span class="dt">"column"</span><span class="fu">:</span> <span class="st">"diagnosis_2"</span><span class="fu">,</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true"></a>                <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"in"</span><span class="fu">,</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true"></a>                <span class="dt">"value"</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">13</span><span class="ot">]</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true"></a>            <span class="fu">},</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true"></a>            <span class="dt">"diag3"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true"></a>                <span class="dt">"column"</span><span class="fu">:</span> <span class="st">"diagnosis_3"</span><span class="fu">,</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true"></a>                <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"in"</span><span class="fu">,</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true"></a>                <span class="dt">"value"</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">13</span><span class="ot">]</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true"></a>            <span class="fu">}</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true"></a>        <span class="fu">}</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true"></a>    <span class="fu">}</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true"></a><span class="fu">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="combining-both-filters">Combining both filters<a class="anchor" aria-label="anchor" href="#combining-both-filters"></a>
</h3>
<p>To combine both filters, we can nest both of these within an <code>"and"</code> filter.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a>    <span class="er">...</span><span class="fu">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a>    <span class="dt">"filter"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"and"</span><span class="fu">,</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true"></a>        <span class="dt">"subfilter"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true"></a>            <span class="dt">"date"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true"></a>                <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"and"</span><span class="fu">,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true"></a>                <span class="dt">"subfilter"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true"></a>                    <span class="dt">"date1"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true"></a>                        <span class="dt">"column"</span><span class="fu">:</span> <span class="st">"date"</span><span class="fu">,</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true"></a>                        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"date_gt_eq"</span><span class="fu">,</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true"></a>                        <span class="dt">"value"</span><span class="fu">:</span> <span class="st">"2017-01-01"</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true"></a>                    <span class="fu">},</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true"></a>                    <span class="dt">"date2"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true"></a>                        <span class="dt">"column"</span><span class="fu">:</span> <span class="st">"date"</span><span class="fu">,</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true"></a>                        <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"date_lt_eq"</span><span class="fu">,</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true"></a>                        <span class="dt">"value"</span><span class="fu">:</span> <span class="st">"2017-12-31"</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true"></a>                    <span class="fu">}</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true"></a>                <span class="fu">}</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true"></a>            <span class="fu">},</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true"></a>            <span class="dt">"diag"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true"></a>                <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"or"</span><span class="fu">,</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true"></a>                <span class="dt">"subfilter"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true"></a>                      <span class="dt">"diag1"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true"></a>                          <span class="dt">"column"</span><span class="fu">:</span> <span class="st">"diagnosis_1"</span><span class="fu">,</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true"></a>                          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"in"</span><span class="fu">,</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true"></a>                          <span class="dt">"value"</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">13</span><span class="ot">]</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true"></a>                      <span class="fu">},</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true"></a>                      <span class="dt">"diag2"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true"></a>                          <span class="dt">"column"</span><span class="fu">:</span> <span class="st">"diagnosis_2"</span><span class="fu">,</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true"></a>                          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"in"</span><span class="fu">,</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true"></a>                          <span class="dt">"value"</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">13</span><span class="ot">]</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true"></a>                      <span class="fu">},</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true"></a>                      <span class="dt">"diag3"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true"></a>                          <span class="dt">"column"</span><span class="fu">:</span> <span class="st">"diagnosis_3"</span><span class="fu">,</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true"></a>                          <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"in"</span><span class="fu">,</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true"></a>                          <span class="dt">"value"</span><span class="fu">:</span> <span class="ot">[</span><span class="dv">13</span><span class="ot">]</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true"></a>                      <span class="fu">}</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true"></a>                <span class="fu">}</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true"></a>            <span class="fu">}</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true"></a>        <span class="fu">}</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true"></a>    <span class="fu">}</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true"></a><span class="fu">}</span></span></code></pre></div>
<p>Note that this can in principle be simplified, because</p>
<pre><code>(date1 AND date2) AND (diag1 OR diag2 OR diag3)</code></pre>
<p>is really the same as</p>
<pre><code>date1 AND date2 AND (diag1 OR diag2 OR diag3)</code></pre>
<p>and so we do not really need to nest the filters so deeply. However, the above will work correctly, so we will keep it as it is.</p>
</div>
<div class="section level3">
<h3 id="the-feature">The feature<a class="anchor" aria-label="anchor" href="#the-feature"></a>
</h3>
<p>The JSON file for this feature is again provided as part of the package. It is exactly the same as the earlier example, except that the filter above has been added in.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ae_neurology_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eider_example.html">eider_example</a></span><span class="op">(</span><span class="st">"ae_attendances_neurology_2017.json"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">ae_neurology_filepath</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;     "source_file": "ae",</span></span>
<span><span class="co">#&gt;     "transformation_type": "COUNT",</span></span>
<span><span class="co">#&gt;     "grouping_column": "id",</span></span>
<span><span class="co">#&gt;     "absent_default_value": 0,</span></span>
<span><span class="co">#&gt;     "output_feature_name": "total_neurology_ae_attendances",</span></span>
<span><span class="co">#&gt;     "filter": {</span></span>
<span><span class="co">#&gt;         "type": "and",</span></span>
<span><span class="co">#&gt;         "subfilter": {</span></span>
<span><span class="co">#&gt;             "date": {</span></span>
<span><span class="co">#&gt;                 "type": "and",</span></span>
<span><span class="co">#&gt;                 "subfilter": {</span></span>
<span><span class="co">#&gt;                     "date1": {</span></span>
<span><span class="co">#&gt;                         "column": "date",</span></span>
<span><span class="co">#&gt;                         "type": "date_gt_eq",</span></span>
<span><span class="co">#&gt;                         "value": "2017-01-01"</span></span>
<span><span class="co">#&gt;                     },</span></span>
<span><span class="co">#&gt;                     "date2": {</span></span>
<span><span class="co">#&gt;                         "column": "date",</span></span>
<span><span class="co">#&gt;                         "type": "date_lt_eq",</span></span>
<span><span class="co">#&gt;                         "value": "2017-12-31"</span></span>
<span><span class="co">#&gt;                     }</span></span>
<span><span class="co">#&gt;                 }</span></span>
<span><span class="co">#&gt;             },</span></span>
<span><span class="co">#&gt;             "diag": {</span></span>
<span><span class="co">#&gt;                 "type": "or",</span></span>
<span><span class="co">#&gt;                 "subfilter": {</span></span>
<span><span class="co">#&gt;                     "diag1": {</span></span>
<span><span class="co">#&gt;                         "column": "diagnosis_1",</span></span>
<span><span class="co">#&gt;                         "type": "in",</span></span>
<span><span class="co">#&gt;                         "value": [</span></span>
<span><span class="co">#&gt;                             13</span></span>
<span><span class="co">#&gt;                         ]</span></span>
<span><span class="co">#&gt;                     },</span></span>
<span><span class="co">#&gt;                     "diag2": {</span></span>
<span><span class="co">#&gt;                         "column": "diagnosis_2",</span></span>
<span><span class="co">#&gt;                         "type": "in",</span></span>
<span><span class="co">#&gt;                         "value": [13]</span></span>
<span><span class="co">#&gt;                     },</span></span>
<span><span class="co">#&gt;                     "diag3": {</span></span>
<span><span class="co">#&gt;                         "column": "diagnosis_3",</span></span>
<span><span class="co">#&gt;                         "type": "in",</span></span>
<span><span class="co">#&gt;                         "value": [13]</span></span>
<span><span class="co">#&gt;                     }</span></span>
<span><span class="co">#&gt;                 }</span></span>
<span><span class="co">#&gt;             }</span></span>
<span><span class="co">#&gt;         }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>This feature can be run in the same way as the previous one. To make things slightly more interesting, we will provide both features to <code><a href="../reference/run_pipeline.html">run_pipeline()</a></code> at the same time:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_pipeline.html">run_pipeline</a></span><span class="op">(</span></span>
<span>  data_sources <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ae <span class="op">=</span> <span class="va">ae_data_filepath</span><span class="op">)</span>,</span>
<span>  feature_filenames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">ae_count_filepath</span>, <span class="va">ae_neurology_filepath</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">features</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 20</span></span>
<span><span class="co">#&gt; Columns: 3</span></span>
<span><span class="co">#&gt; $ id                             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 1…</span></span>
<span><span class="co">#&gt; $ total_ae_attendances           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 9, 3, 3, 4, 2, 5, 6, 8, 7, 2, 5, 4, 6, …</span></span>
<span><span class="co">#&gt; $ total_neurology_ae_attendances <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</span></span></code></pre></div>
<p>In this case, we can see that patient 0 (for example) has had 9 total attendances, but only 1 of these were in 2017 and resulted in a neurology diagnosis.</p>
</div>
</div>
<div class="section level2">
<h2 id="checking-the-results-so-far">Checking the results (so far)<a class="anchor" aria-label="anchor" href="#checking-the-results-so-far"></a>
</h2>
<p>We can verify some of the results above using a standard <code>dplyr</code> pipeline. For feature 1:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ae_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total_ae_attendances <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 20</span></span>
<span><span class="co">#&gt; Columns: 2</span></span>
<span><span class="co">#&gt; $ id                   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,…</span></span>
<span><span class="co">#&gt; $ total_ae_attendances <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 9, 3, 3, 4, 2, 5, 6, 8, 7, 2, 5, 4, 6, 8, 3, 5, 1…</span></span></code></pre></div>
<p>and for feature 2:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ae_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&gt;=</span> <span class="st">"2017-01-01"</span>, <span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2017-12-31"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">diagnosis_1</span> <span class="op">==</span> <span class="fl">13</span> <span class="op">|</span> <span class="va">diagnosis_2</span> <span class="op">==</span> <span class="fl">13</span> <span class="op">|</span> <span class="va">diagnosis_3</span> <span class="op">==</span> <span class="fl">13</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total_neurology_ae_attendances <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 2</span></span>
<span><span class="co">#&gt; Columns: 2</span></span>
<span><span class="co">#&gt; $ id                             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 2</span></span>
<span><span class="co">#&gt; $ total_neurology_ae_attendances <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1</span></span></code></pre></div>
<p>This tells us that patients 0 and 2 are the only ones with any neurology attendances in 2017, and is consistent with the feature table that <code>eider</code> has calculated. However, notice that <code>eider</code> has taken care of joining the features together and inserting the missing value of 0 where necessary. Using <code>eider</code> also helps to avoid errors that can easily creep in when data is mutated in a long script.</p>
</div>
<div class="section level2">
<h2 id="feature-3-whether-a-patient-has-ever-attended-ae">Feature 3: Whether a patient has ever attended A&amp;E<a class="anchor" aria-label="anchor" href="#feature-3-whether-a-patient-has-ever-attended-ae"></a>
</h2>
<p>Through a slight modification of the first feature, we can also calculate whether a patient has ever attended A&amp;E. This is a binary feature, which has values of either 1 (if the patient has attended A&amp;E) or 0 (if they have not). All we need to do is to replace the <code>transformation_type</code> with <code>"present"</code> (instead of <code>"count"</code>):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ae_present_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eider_example.html">eider_example</a></span><span class="op">(</span><span class="st">"has_visited_ae.json"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">ae_present_filepath</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "source_file": "ae",</span></span>
<span><span class="co">#&gt;   "transformation_type": "present",</span></span>
<span><span class="co">#&gt;   "grouping_column": "id",</span></span>
<span><span class="co">#&gt;   "output_feature_name": "has_visited_ae"</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_pipeline.html">run_pipeline</a></span><span class="op">(</span></span>
<span>  data_sources <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ae <span class="op">=</span> <span class="va">ae_data_filepath</span><span class="op">)</span>,</span>
<span>  feature_filenames <span class="op">=</span> <span class="va">ae_present_filepath</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">features</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 20</span></span>
<span><span class="co">#&gt; Columns: 2</span></span>
<span><span class="co">#&gt; $ id             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 1…</span></span>
<span><span class="co">#&gt; $ has_visited_ae <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="feature-4-the-number-of-days-since-the-last-ae-attendance">Feature 4: The number of days since the last A&amp;E attendance<a class="anchor" aria-label="anchor" href="#feature-4-the-number-of-days-since-the-last-ae-attendance"></a>
</h2>
<p>As an example of a completely different transformation type, we look at the <code>"time_since"</code> feature type here. As the name suggests, this calculates the time since an event: in this case, we specify “from_first”: “false”<code>and</code>“cutoff_date”: “2021-03-25” to calculate the time since the last event up to 25 March 2021; and <code>"time_units": "days"</code> to return the value in days. The <code>"date_column"</code> specifies the name of the column in the input table which contains the date of attendance.</p>
<p>The default value for patients who do not appear in this dataset should, logically, be set to something large, to indicate that they have not had a recent A&amp;E attendance. In this case we use 2000.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">days_since_ae_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eider_example.html">eider_example</a></span><span class="op">(</span><span class="st">"days_since_last_ae.json"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">days_since_ae_filepath</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "source_file": "ae",</span></span>
<span><span class="co">#&gt;   "grouping_column": "id",</span></span>
<span><span class="co">#&gt;   "transformation_type": "time_since",</span></span>
<span><span class="co">#&gt;   "time_units": "days",</span></span>
<span><span class="co">#&gt;   "from_first": false,</span></span>
<span><span class="co">#&gt;   "output_feature_name": "days_since_last_ae_visit",</span></span>
<span><span class="co">#&gt;   "date_column": "date",</span></span>
<span><span class="co">#&gt;   "cutoff_date": "2021-03-25",</span></span>
<span><span class="co">#&gt;   "absent_default_value": 2000</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_pipeline.html">run_pipeline</a></span><span class="op">(</span></span>
<span>  data_sources <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ae <span class="op">=</span> <span class="va">ae_data_filepath</span><span class="op">)</span>,</span>
<span>  feature_filenames <span class="op">=</span> <span class="va">days_since_ae_filepath</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">features</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 20</span></span>
<span><span class="co">#&gt; Columns: 2</span></span>
<span><span class="co">#&gt; $ id                       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13,…</span></span>
<span><span class="co">#&gt; $ days_since_last_ae_visit <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 1189, 1189, 1221, 1231, 1407, 1422, 1261, 130…</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Camila Rangel Smith, Helen Duncan Little, Jonathan Yong.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="eider">
<title>Preprocessing • eider</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Fira_Sans-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Fira_Mono-0.4.9/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Preprocessing">
<meta property="og:description" content="eider">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">eider</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/eider.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Feature types</h6>
    <a class="dropdown-item" href="../articles/features.html">Features: An overview</a>
    <a class="dropdown-item" href="../articles/feature_count.html">Features: Counting rows</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Subfields</h6>
    <a class="dropdown-item" href="../articles/preprocessing.html">Preprocessing</a>
    <a class="dropdown-item" href="../articles/filtering.html">Filtering</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Logging</h6>
    <a class="dropdown-item" href="../articles/logging.html">Logging Example</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Examples</h6>
    <a class="dropdown-item" href="../articles/a_and_e.html">A &amp; E Example</a>
    <a class="dropdown-item" href="../articles/combine.html">Combine Example</a>
    <a class="dropdown-item" href="../articles/prescribing.html">Prescribing Example</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="preprocessing_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Preprocessing</h1>
            
      
      
      <div class="d-none name"><code>preprocessing.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">eider</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span></code></pre></div>
<p>Inside each feature JSON, an optional <code>preprocess</code> object can be included, which causes the input table to be modified in a particular way before the feature is calculated.</p>
<p>This is primarily useful for data where each row represents some subdivision of a larger entity, and the user wants to calculate features based on the information from those larger entity. In particular, this is useful for <em>episodic data</em>, where each row represents an <em>episode</em> within a continuous hospital <em>stay</em>.</p>
<div class="section level2">
<h2 id="example-data">Example data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h2>
<p>For example, consider the following dataframe. The loading of data here is only shown for illustrative purposes: when using <code>eider</code> you do not need to do any of this as it is all handled internally.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smr04_data_filepath</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eider_example.html">eider_example</a></span><span class="op">(</span><span class="st">"random_smr04_data.csv"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">initial_table</span> <span class="op">&lt;-</span> <span class="va">smr04_data_filepath</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    admission_date <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="va">admission_date</span><span class="op">)</span>,</span>
<span>    discharge_date <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd.html" class="external-link">ymd</a></span><span class="op">(</span><span class="va">discharge_date</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">initial_table</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 190 × 7</span></span></span>
<span><span class="co">#&gt;       id admission_date discharge_date cis_marker episode_within_cis</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>    16 2015-12-04     2015-12-07             89                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>    10 2015-11-03     2015-11-04             19                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>    10 2015-11-04     2015-11-04             19                  2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>    15 2016-02-08     2016-02-09             72                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>    15 2016-02-09     2016-02-10             72                  2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>    17 2017-07-30     2017-08-01             80                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>    17 2017-08-01     2017-08-02             80                  2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>    14 2017-01-08     2017-01-08             78                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    14 2017-01-08     2017-01-09             78                  2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    14 2017-01-09     2017-01-11             78                  3</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 180 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: admission_type &lt;int&gt;, specialty &lt;chr&gt;</span></span></span></code></pre></div>
<p>Here, each row is an episode; multiple episodes make up a stay. The <code>cis_marker</code> field is used to label stays, and can thus be used to identify episodes belonging to the same stay. In this case, the <code>episode_within_cis</code> tells us the order of the episodes within a stay; this is not always present, though.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;      id admission_date discharge_date cis_marker episode_within_cis</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     3 2016-10-15     2016-10-16             44                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     3 2016-10-16     2016-10-17             44                  2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 2016-10-17     2016-10-19             44                  3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     3 2016-10-19     2016-10-20             44                  4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     3 2016-01-02     2016-01-04             45                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     3 2016-03-08     2016-03-08             46                  1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: admission_type &lt;int&gt;, specialty &lt;chr&gt;</span></span></span></code></pre></div>
<p>Using patient with ID of 3 as an example - the data contains details of 4 episodes (with <code>CIS_MARKERS</code> of 23, 24, 25, and 26). For the stay with <code>CIS_MARKER</code> 23, there were three episodes, all started on 17th May 2015 and ended on the same date. For the stays with <code>CIS_MARKER</code> 24, and 25, there was only one episode, and for the stay with <code>CIS_MARKER</code> 26 there were 3 episodes, the first episode had an admission date of 21st April 2015, and a discharge date of the 22nd April. The second episode had an admission date of the 22nd April and a discharge date of the same day, and the third episode had an admission date of the 22nd but a discharge date of the 24th. This stay for patient 3 spanned the 21st to 24th of April.</p>
<p>With episodic data is could be necessary to filter on dates. If in the example of patient with ID 14 the cut-off-date was set as 1st August, then the first episode in their stay would be omitted, and potentially the second episode would be assumed to be the first.</p>
</div>
<div class="section level2">
<h2 id="the-preprocessing-step">The preprocessing step<a class="anchor" aria-label="anchor" href="#the-preprocessing-step"></a>
</h2>
<p>The way <code>eider</code> has approached this, is to allow users to pre-process their data, to merge episodes into stays. In this case by specifying that they can select the earliest admission date for each stay and the latest discharge date for each stay and replace each episode with the stay-related span.</p>
<p>The key features outlined here are: - <code>preprocess$on</code>, which specifies how to group the data for preprocessing. This is a list of column names (i.e. strings). - <code>preprocess$retain_min</code> and <code>preprocess$retain_max</code>, which are the columns for which we want to keep the minimum and maximum values of within each group. These entries can contain multiple (or zero) columns which we want to preprocess.</p>
<p>For example, in a JSON specification file, the following could be included:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a>  <span class="dt">"source_file"</span><span class="fu">:</span> <span class="st">"smr04"</span><span class="fu">,</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>  <span class="er">...</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>  <span class="dt">"preprocess"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>    <span class="dt">"on"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"id"</span><span class="ot">,</span> <span class="st">"cis_marker"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>    <span class="dt">"retain_min"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"admission_date"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>    <span class="dt">"retain_max"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"discharge_date"</span><span class="ot">]</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>  <span class="fu">},</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>  <span class="er">...</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a><span class="fu">}</span></span></code></pre></div>
<p>This mini-specification will use the <code>cis_marker</code> column to identify which episodes belong with a given patient stay, and then the minimum <code>admission_date</code> and maximum <code>discharge_date</code> are replaced in the initial data. Using a JSON file like this will result in the <code>smr04</code> table being converted into this before the feature itself is calculated. Again, none of this has to be done manually, it is all handled internally by <code>eider</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">processed_table</span> <span class="op">&lt;-</span> <span class="va">initial_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">cis_marker</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    admission_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">admission_date</span><span class="op">)</span>,</span>
<span>    discharge_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">discharge_date</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">processed_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt;      id admission_date discharge_date cis_marker episode_within_cis</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     3 2016-10-15     2016-10-20             44                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     3 2016-10-15     2016-10-20             44                  2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 2016-10-15     2016-10-20             44                  3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     3 2016-10-15     2016-10-20             44                  4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     3 2016-01-02     2016-01-04             45                  1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     3 2016-03-08     2016-03-08             46                  1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: admission_type &lt;int&gt;, specialty &lt;chr&gt;</span></span></span></code></pre></div>
<p>The pre-processing mutates the initial table and (based on the specification) takes the earliest admission date for each stay (comprising a single or multiple episodes) and the latest discharge date. So now patient 3 still has 4 stays in the data, but all episodes within the <code>cis_marker=26</code> stay are given the same admission and discharge date. This allows the user to filter the list of episodes based on the overall stay dates, rather than the dates for each episode itself.</p>
</div>
<div class="section level2">
<h2 id="feature-outputs">Feature outputs<a class="anchor" aria-label="anchor" href="#feature-outputs"></a>
</h2>
<p>Here are two full specification files, one without the preprocessing request, and one with.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec_without_preprocessing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eider_example.html">eider_example</a></span><span class="op">(</span><span class="st">"spec_smr04.json"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">spec_without_preprocessing</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "source_file": ["smr04"],</span></span>
<span><span class="co">#&gt;   "transformation_type": ["COUNT"],</span></span>
<span><span class="co">#&gt;   "grouping_column": ["id"],</span></span>
<span><span class="co">#&gt;   "absent_default_value": 0,</span></span>
<span><span class="co">#&gt;   "output_feature_name": ["no_preprocessing"],</span></span>
<span><span class="co">#&gt;   "primary_filter": {</span></span>
<span><span class="co">#&gt;     "type": ["AND"],</span></span>
<span><span class="co">#&gt;     "subfilters": {</span></span>
<span><span class="co">#&gt;       "subfilter_1": {</span></span>
<span><span class="co">#&gt;         "column": ["episode_within_cis"],</span></span>
<span><span class="co">#&gt;         "type": ["IN"],</span></span>
<span><span class="co">#&gt;         "value": [1, 2, 3]</span></span>
<span><span class="co">#&gt;       },</span></span>
<span><span class="co">#&gt;     "subfilter_2": {</span></span>
<span><span class="co">#&gt;         "column": "discharge_date",</span></span>
<span><span class="co">#&gt;         "type": "date_lt_eq",</span></span>
<span><span class="co">#&gt;         "value": ["2015-04-22"]</span></span>
<span><span class="co">#&gt;       }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>This spec is requesting a count of the number of times episode 1, 2, or 3 from <code>episode_within_cis</code> occurs for <code>DISCHARGE_DATE</code> earlier than (or equal to) 22nd April 2015.</p>
<p>For patient 3, without the preprocessing step we expect this to count 2 of the 8 episodes, the two with <code>CIS_MARKER</code> 26 and <code>DISCHARGE_DATE</code> of 22nd April 2015, the final episode in that stay does not satisfy the date condition and so is not expected to be counted.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spec_with_preprocessing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/eider_example.html">eider_example</a></span><span class="op">(</span><span class="st">"spec_smr04_preprocessing.json"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">spec_with_preprocessing</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; {</span></span>
<span><span class="co">#&gt;   "source_file": ["smr04"],</span></span>
<span><span class="co">#&gt;   "transformation_type": ["COUNT"],</span></span>
<span><span class="co">#&gt;   "grouping_column": ["id"],</span></span>
<span><span class="co">#&gt;   "absent_default_value": 0,</span></span>
<span><span class="co">#&gt;   "output_feature_name": ["with_preprocessing"],</span></span>
<span><span class="co">#&gt;   "preprocess": {</span></span>
<span><span class="co">#&gt;     "on": ["id", "cis_marker"],</span></span>
<span><span class="co">#&gt;     "retain_min": "admission_date",</span></span>
<span><span class="co">#&gt;     "retain_max": "discharge_date"</span></span>
<span><span class="co">#&gt;     },</span></span>
<span><span class="co">#&gt;   "primary_filter": {</span></span>
<span><span class="co">#&gt;     "type": ["AND"],</span></span>
<span><span class="co">#&gt;     "subfilters": {</span></span>
<span><span class="co">#&gt;       "subfilter_1": {</span></span>
<span><span class="co">#&gt;         "column": ["episode_within_cis"],</span></span>
<span><span class="co">#&gt;         "type": ["IN"],</span></span>
<span><span class="co">#&gt;         "value": [1, 2, 3]</span></span>
<span><span class="co">#&gt;       },</span></span>
<span><span class="co">#&gt;     "subfilter_2": {</span></span>
<span><span class="co">#&gt;         "column": "discharge_date",</span></span>
<span><span class="co">#&gt;         "type": "date_lt_eq",</span></span>
<span><span class="co">#&gt;         "value": ["2015-04-22"]</span></span>
<span><span class="co">#&gt;       }</span></span>
<span><span class="co">#&gt;     }</span></span>
<span><span class="co">#&gt;   }</span></span>
<span><span class="co">#&gt; }</span></span></code></pre></div>
<p>This spec is requesting the same thing, but now has the preprocessing step included. The <code>DISCHARGE_DATE</code> for all episodes in the stay with <code>CIS_MARKER</code> 26 will now all be the same - the latest discharge date from the stay, and the transform will count none of the total episodes for patient 3. This means that there will now be zero episodes which match the criteria.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_pipeline.html">run_pipeline</a></span><span class="op">(</span></span>
<span>  data_sources <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>smr04 <span class="op">=</span> <span class="fu"><a href="../reference/eider_example.html">eider_example</a></span><span class="op">(</span><span class="st">"random_smr04_data.csv"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  feature_filenames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="va">spec_without_preprocessing</span>,</span>
<span>    <span class="va">spec_with_preprocessing</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">processed</span><span class="op">$</span><span class="va">features</span></span>
<span><span class="co">#&gt;    id no_preprocessing with_preprocessing</span></span>
<span><span class="co">#&gt; 1   0                0                  0</span></span>
<span><span class="co">#&gt; 2   1                0                  0</span></span>
<span><span class="co">#&gt; 3   2                0                  0</span></span>
<span><span class="co">#&gt; 4   3                0                  0</span></span>
<span><span class="co">#&gt; 5   4                1                  1</span></span>
<span><span class="co">#&gt; 6   5                3                  3</span></span>
<span><span class="co">#&gt; 7   6                0                  0</span></span>
<span><span class="co">#&gt; 8   7                1                  1</span></span>
<span><span class="co">#&gt; 9   8                1                  1</span></span>
<span><span class="co">#&gt; 10  9                1                  1</span></span>
<span><span class="co">#&gt; 11 10                0                  0</span></span>
<span><span class="co">#&gt; 12 11                0                  0</span></span>
<span><span class="co">#&gt; 13 12                0                  0</span></span>
<span><span class="co">#&gt; 14 13                0                  0</span></span>
<span><span class="co">#&gt; 15 14                0                  0</span></span>
<span><span class="co">#&gt; 16 15                5                  5</span></span>
<span><span class="co">#&gt; 17 16                0                  0</span></span>
<span><span class="co">#&gt; 18 17                0                  0</span></span>
<span><span class="co">#&gt; 19 18                2                  2</span></span>
<span><span class="co">#&gt; 20 19                0                  0</span></span></code></pre></div>
<p>Comparing the above, we can see that for patient with id 3, when no pre-processing is applied, two episodes are counted, but when the preprocessing step is applied, zero are.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Camila Rangel Smith, Helen Duncan Little, Jonathan Yong.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
